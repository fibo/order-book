(this["webpackJsonporder-book"]=this["webpackJsonporder-book"]||[]).push([[0],{12:function(e,r,t){},14:function(e,r,t){"use strict";t.r(r);var c=t(3),o=t.n(c),a=t(7),n=t.n(a),s=(t(12),t(2)),b=t(0);function i(e){var r=e.groupSize;return Object(b.jsx)("select",{className:"order-book-select",children:Object(b.jsxs)("option",{children:["Group ",r]})})}var d=t(4),u=t.n(d);function l(e){var r=e.rows,t=e.side,c="buy"===t,o="sell"===t;return Object(b.jsxs)("div",{className:"order-book-table",children:[Object(b.jsx)("div",{className:u()("order-book-table__header",{"order-book-table__header--buy":c,"order-book-table__header--sell":o}),children:["price","size","total"].map((function(e,r){return Object(b.jsx)("span",{children:e},r)}))}),Object(b.jsx)("div",{className:"order-book-table__body",children:r.map((function(e,r){var t=Object(s.a)(e,4),a=t[0],n=t[1],i=t[2],d=t[3];return Object(b.jsxs)("div",{className:u()("order-book-table__row",{"order-book-table__row--buy":c,"order-book-table__row--sell":o}),children:[Object(b.jsx)("div",{className:u()("order-book-table__meter",{"order-book-table__meter--buy":c,"order-book-table__meter--sell":o}),style:{width:"".concat(d,"%")}}),Object(b.jsx)("span",{className:u()("order-book-table__cell",{"order-book-table__cell--buy":c,"order-book-table__cell--sell":o}),children:a}),Object(b.jsx)("span",{children:n}),Object(b.jsx)("span",{children:i})]},r)}))})]})}function O(e){var r=e.data,t=r.asks,c=r.bids,o=e.groupSize,a=e.onClickToggleFeed,n=e.onClickKillFeed,s=e.webSocketIsOpen;return Object(b.jsxs)("div",{className:"order-book",children:[Object(b.jsxs)("div",{className:"order-book__header",children:[Object(b.jsx)("div",{children:"Order Book"}),Object(b.jsx)(i,{groupSize:o})]}),Object(b.jsxs)("div",{className:"order-book__content",children:[Object(b.jsx)(l,{rows:t,side:"sell"}),Object(b.jsx)(l,{rows:c,side:"buy"})]}),Object(b.jsxs)("div",{className:"order-book__footer",children:[Object(b.jsx)("button",{className:"button button--toggle",disabled:!s,onClick:a,children:"Toggle Feed"}),Object(b.jsx)("button",{className:"button button--kill",disabled:!s,onClick:n,children:"Kill Feed"})]})]})}var j=t(5),f=t(1),k=WebSocket.CONNECTING,_=WebSocket.CLOSING,E=WebSocket.CLOSED,h=WebSocket.OPEN;function v(e){var r=e.asks,t=e.bids;return{asks:N(r),bids:N(t)}}function S(e,r){switch(e){case.5:var t=Math.floor(r);return r-t>=e?t+e:t;case 1:return Math.floor(r);default:return r}}var p=function(e){return 0===Object(s.a)(e,2)[1]};function N(e){return e.reduce((function(e,r){var t=Object(s.a)(r,2),c=t[0],o=t[1];return Object(f.a)(Object(f.a)({},e),{},Object(j.a)({},c,o))}),{})}function g(e,r){for(var t={},c=0,o=Object.entries(r);c<o.length;c++){var a=Object(s.a)(o[c],2),n=a[0],b=a[1],i=S(e,Number(n));"undefined"===typeof t[i]?t[i]={size:b,total:0,percentage:0}:t[i]={size:t[i].size+b,total:0,percentage:0}}return Object.entries(t).sort((function(e,r){var t=Object(s.a)(e,1)[0],c=Object(s.a)(r,1)[0];return t<c?1:t>c?-1:0})).map((function(e){var r=Object(s.a)(e,2),t=r[0],c=r[1],o=c.size,a=c.total,n=c.percentage;return[Number(t),o,a,n]}))}function y(e,r){var t=r.asks,c=r.bids;return{asks:g(e,t),bids:g(e,c)}}var m=function(e){return e.readyState===WebSocket.OPEN},C=function(e){return e.groupSize};function x(e,r){switch(r.type){case"WEBSOCKET_CLOSED":return Object(f.a)(Object(f.a)({},e),{},{readyState:E});case"WEBSOCKET_CLOSING":return Object(f.a)(Object(f.a)({},e),{},{readyState:_});case"WEBSOCKET_CONNECTING":return Object(f.a)(Object(f.a)({},e),{},{readyState:k});case"WEBSOCKET_ERROR":return e;case"WEBSOCKET_OPEN":return Object(f.a)(Object(f.a)({},e),{},{readyState:h});case"WEBSOCKET_RECEIVE_MESSAGE":try{var t="string"===typeof r.data?JSON.parse(r.data):{},c="info"===t.event,o="subscribed"===t.event,a="string"===typeof t.feed&&t.feed.length>0,n=Array.isArray(t.asks),b=Array.isArray(t.bids),i=n&&b,d=a&&t.feed.endsWith("_snapshot");switch(!0){case c:return Object(f.a)(Object(f.a)({},e),{},{connected:!0});case o&&a:return Object(f.a)(Object(f.a)({},e),{},{feed:t.feed});case d&&i:var u=C(e),l=v(t);return Object(f.a)(Object(f.a)({},e),{},{orderBook:l,aggregatedOrderBook:y(u,l)});case i&&!d:var O=t,j=O.asks,S=O.bids,g=C(e),m=function(e){return e.orderBook}(e),x=m.asks,w=m.bids,B=N(j.filter(p));console.log(B);var T=N(S.filter(p)),W=[],K=[];Object.entries(x).forEach((function(e){var r=Object(s.a)(e,2),t=r[0],c=r[1];"undefined"!==typeof B[Number(t)]&&W.push([Number(t),c])})),Object.entries(w).forEach((function(e){var r=Object(s.a)(e,2),t=r[0],c=r[1];"undefined"!==typeof T[Number(t)]&&K.push([Number(t),c])}));var z=v({asks:W.concat(j),bids:K.concat(S)});return Object(f.a)(Object(f.a)({},e),{},{orderBook:z,aggregatedOrderBook:y(g,z)});default:return e}}catch(I){return console.error(I),e}default:return e}}function w(e){var r=Object(c.useReducer)(x,{connected:!1,aggregatedOrderBook:{asks:[],bids:[]},groupSize:.5,orderBook:{asks:{},bids:{}},readyState:null}),t=Object(s.a)(r,2),o=t[0],a=t[1],n=Object(c.useRef)(),b=function(e){return e.readyState}(o),i=m(o),d=Object(c.useCallback)((function(e){if(i){var r=n.current;r&&r.send(JSON.stringify(e))}}),[i,n]);return Object(c.useEffect)((function(){if(null===b)try{var r=function(e,r){try{var t=new WebSocket(e);return r({type:"WEBSOCKET_CONNECTING"}),t.onopen=function(){r({type:"WEBSOCKET_OPEN"})},t.onerror=function(e){console.error(e),r({type:"WEBSOCKET_ERROR"})},t.onmessage=function(e){r({type:"WEBSOCKET_RECEIVE_MESSAGE",data:e.data})},t}catch(c){throw c}}(e,a);n.current=r}catch(t){console.error(t)}}),[b,e]),[o,d]}function B(){var e=w("wss://www.cryptofacilities.com/ws/v1"),r=Object(s.a)(e,2),t=r[0],o=r[1],a=C(t),n=m(t),i=function(e){return e.aggregatedOrderBook}(t),d=function(e){return e.connected}(t),u=Object(c.useCallback)((function(){n&&o({event:"subscribe",feed:"book_ui_1",product_ids:["PI_XBTUSD"]})}),[o,n]);return Object(c.useEffect)((function(){d&&u()}),[d,u]),Object(b.jsx)("div",{className:"container",children:Object(b.jsx)(O,{data:i,groupSize:a,onClickToggleFeed:u,onClickKillFeed:u,webSocketIsOpen:n})})}n.a.render(Object(b.jsx)(o.a.StrictMode,{children:Object(b.jsx)(B,{})}),document.querySelector("main"))}},[[14,1,2]]]);
//# sourceMappingURL=main.2b28ba8c.chunk.js.map